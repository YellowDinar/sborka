/**
 * Web-Widget
 * http://sv-dev.ru/ww
 *
 * @version
 * 1.0
 *
 * @copyright
 * Copyright (C) 2014-2015 Sinickij Vladimir.
 *
 * @license
 * MIT License
 */

function WebWidget(){var b=null;this.createWindow=function(g){var j=false,e={settings:{id:g.id||"wwWindow_"+rand(1000,9999),type:g.type||null,trigger:g.trigger||null,drag:g.drag||false,title:g.title||null,html:g.html||"",size:g.size||"auto",layout:g.layout||"default",color:g.color||"#009FB4",position:g.position||true,outside:g.outside||true,scroll:g.scroll||true,indent:g.indent||10},window:{domContainer:null,domContent:null,status:null,trigger:null,drag:false,show:null,hide:null,shift:null,onShow:null,onHide:null}};d();return b=e.window;function d(){if(e.settings.type&&e.settings.trigger){var m,o=e.settings.title?"<div class='wwWindowTitle'>"+e.settings.title+"</div>":"",l=e.window.domContainer||"<div id='"+e.settings.id+"' class='wwWindowWrapper wwWindow_"+e.settings.layout+" ww_"+e.settings.type+"'><div class='wwWindowContainer' style='background-color: "+e.settings.color+";'><div class='wwWindow' style='width: "+e.settings.size+";'><a href='#' class='wwWindowClose'></a>"+o+"<div class='wwWindowInner'>"+e.settings.html+"</div></div></div></div>",n=document.querySelectorAll(e.settings.trigger);append("body",l);e.window.domContainer=document.querySelector("#"+e.settings.id);e.window.domContent=e.window.domContainer.querySelector(".wwWindowInner");e.window.status="hide";for(m=0;m<n.length;m++){if(!e.window.trigger){e.window.trigger=n[m]}n[m].onclick=function(){k(this);return false}}e.window.show=function(){k(e.window.trigger)};e.window.hide=function(){i(e.window.trigger)};e.window.shift=function(){c(e.window.trigger)}}}function k(n){var q,l,p,r,m="ontouchstart" in window||window.navigator.msMaxTouchPoints?true:false,o=window.onclick;if(e.window.trigger&&n){if(typeof e.window.onShow=="function"){e.window.onShow(n)}if(e.settings.type=="popup"){if(e.window.status=="hide"){if(e.settings.scroll){addClass(document.body,"wwSiteLock");if(document.documentElement.scrollHeight>document.documentElement.clientHeight){addClass(document.body,"wwSiteScroll")}}addClass(e.window.domContainer,"show");setTimeout(function(){addClass(e.window.domContainer,"visibleOverlay")},10);setTimeout(function(){addClass(e.window.domContainer,"visibleWindow");e.window.domContainer.onclick=function(s){s=s||window.event;q=s.target||s.srcElement;if(e.settings.outside&&q.className.indexOf("wwWindowWrapper")>=0||q.className.indexOf("wwWindowClose")>=0){i(n);e.window.domContainer.onclick=null;return false}return true};e.window.status="show"},200)}}else{if(e.settings.type=="popover"){if(e.window.status=="show"){e.window.trigger=n;j=true}else{if(e.window.trigger!=n){e.window.trigger=n}addClass(e.window.domContainer,"show");h(n);setTimeout(function(){addClass(e.window.domContainer,"animate")},10);setTimeout(function(){addClass(e.window.domContainer,"visibleWindow")},15);setTimeout(function(){e.window.status="show";c(n);if(e.settings.drag&&!m){try{e.window.drag=true;e.window.domContainer.onmousedown=function(t){t=t||window.event;q=t.target||t.srcElement;if(q.tagName=="INPUT"||q.tagName=="TEXTAREA"||q.tagName=="SELECT"||q.tagName=="LABEL"){return}addClass(document.body,"wwWindowMoving");l=getOffset(e.window.domContainer);l.top=(t.pageY||t.clientY)-l.top;l.left=(t.pageX||t.clientX)-l.left;f(q,l);document.onmousemove=function(u){f(u,l)};e.window.domContainer.onmouseup=function(){removeClass(document.body,"wwWindowMoving");document.onmousemove=null;e.window.domContainer.onmouseup=null}};e.window.domContainer.ondragstart=function(){return false}}catch(s){debugError(s)}}document.documentElement.onclick=function(t){console.log(j);t=t||window.event;q=t.target||t.srcElement;if(e.window.status=="show"){p=q.closest(".wwWindowWrapper");r=q.className.indexOf("wwWindowClose");if(j){c(e.window.trigger);j=false}else{if(e.settings.outside&&!p||r>=0){i(e.window.trigger);window.onclick=o;if(r>=0){return false}}}}return true}},20)}}}}}function f(q,n){try{var s=window.pageYOffset+e.settings.indent,m=window.pageXOffset+e.settings.indent,o=window.pageYOffset+document.documentElement.clientHeight-e.window.domContainer.scrollHeight-e.settings.indent,p=window.pageXOffset+document.documentElement.clientWidth-e.window.domContainer.scrollWidth-e.settings.indent,r=(q.pageY||q.clientY)-n.top,l=(q.pageX||q.clientX)-n.left;r=r<s?s:r>o?o:r;l=l<m?m:l>p?p:l;e.window.domContainer.style.top=r+"px";e.window.domContainer.style.left=l+"px"}catch(q){debugError(q)}}function i(l){if(l&&e.window.status=="show"){if(typeof e.window.onHide=="function"){e.window.onHide(l)}if(e.settings.type=="popup"){removeClass(e.window.domContainer,"visibleWindow");setTimeout(function(){removeClass(e.window.domContainer,"visibleOverlay")},200);setTimeout(function(){if(e.settings.scroll){removeClass(document.body,"wwSiteLock wwSiteScroll")}removeClass(e.window.domContainer,"show");e.window.status="hide"},600)}else{if(e.settings.type=="popover"){removeClass(e.window.domContainer,"visibleWindow");h(l);setTimeout(function(){removeClass(e.window.domContainer,"animate show");e.window.status="hide"},400)}}}}function h(l){try{if(l&&e.settings.type=="popover"){e.window.domContainer.style.top=Math.round((getOffset(l).top+l.scrollHeight/2)-e.window.domContainer.scrollHeight/2)+"px";e.window.domContainer.style.left=Math.round((getOffset(l).left+l.scrollWidth/2)-e.window.domContainer.scrollWidth/2)+"px"}}catch(m){debugError(m)}}function c(n){try{if(n&&e.settings.type=="popover"&&e.window.status=="show"){var q=getOffset(n),s=q.top,t=q.left;if(e.settings.position===true){var o=window.pageYOffset+e.settings.indent,p=window.pageXOffset+e.settings.indent,l=window.pageYOffset+document.documentElement.clientHeight-e.window.domContainer.scrollHeight-e.settings.indent,m=window.pageXOffset+document.documentElement.clientWidth-e.window.domContainer.scrollWidth-e.settings.indent;s=s+n.scrollHeight/2-e.window.domContainer.scrollHeight/2;t=t+n.scrollWidth/2-e.window.domContainer.scrollWidth/2;s=s<o?o:s>l?l:s;t=t<p?p:t>m?m:t}e.window.domContainer.style.top=Math.round(s)+"px";e.window.domContainer.style.left=Math.round(t)+"px"}}catch(r){debugError(r)}}};this.createForm=function(f){var m=this,d={settings:{inner:f.inner||null,form:f.form||null,action:f.action||null,layout:f.layout||"default",color:f.color||"#009FB4",prefix:f.prefix||rand(1000,9999),errors:f.errors!==undefined?f.errors:true,quit:f.quit!==undefined?f.quit:true},form:{domContainer:null,domForm:null,loader:null,onLoad:null,onSubmit:null}};c();return d.form;function c(){if(b){d.form.domContainer=b.domContent}if(!d.form.domContainer&&d.settings.inner){d.form.domContainer=d.settings.inner.nodeType?d.settings.inner:document.querySelector(d.settings.inner)}if(d.form.domContainer&&d.settings.action&&d.settings.form){if(!d.form.domContainer.querySelector("form")){m.postRequest({action:d.settings.action,data:{wwForm:d.settings.form,wwStatus:"get",wwPrefix:d.settings.prefix},success:function(n){if(!n||typeof n=="string"){j("Request error!",2);debugError(n)}else{if(!d.form.domContainer.querySelector("#wwFormContainer_"+d.settings.form+"_"+d.settings.prefix)){k(n)}}}})}else{k(null)}}}function k(p){var n,o,q;if(typeof d.form.onLoad=="function"){d.form.onLoad()}if(p&&p.data){append(d.form.domContainer,p.data)}if(!d.form.domContainer.querySelector("form")){return}d.form.domContainer=d.form.domContainer.querySelector("#wwFormContainer_"+d.settings.form+"_"+d.settings.prefix);d.form.domForm=d.form.domContainer.querySelector("form");d.form.loader=m.createLoader({inner:d.form.domContainer,color:d.settings.color,layout:d.settings.layout});d.form.domForm.style.color=d.settings.color;d.form.domForm.querySelector("input[type=submit]").style.backgroundColor=d.settings.color;if(b&&!b.drag){b.shift()}if(d.form.domForm.querySelector(".wwFormCaptcha")){n=d.form.domForm.querySelectorAll(".wwFormCaptcha");for(o=0;o<n.length;o++){e(n[o])}}d.form.domForm.onsubmit=function(){m.postRequest({action:d.settings.action,form:d.form.domForm,loader:d.form.loader,data:{wwForm:d.settings.form,wwStatus:"send",wwPrefix:d.settings.prefix},success:function(r){if(!r||r==""){j("An empty query result",1)}else{if(typeof r=="string"){j(r,2)}else{l(r);h(r);if(r.submitted){if(b){addClass(b.domContainer,"wwFormOnSuccessx")}d.settings.quit?d.form.domForm.remove():i();setTimeout(function(){q=d.form.domContainer.querySelector(".wwSuccessText");if(q){addClass(q,"visible")}},10);if(typeof d.form.onSubmit=="function"){d.form.onSubmit()}}}}if(b&&!b.drag){b.shift()}}});return false}}function i(){var n,o;n=d.form.domForm.querySelectorAll(".wwFormFieldWrap input, .wwFormFieldWrap textarea, .wwFormFieldWrap select");for(o=0;o<n.length;o++){n[o].value=""}}function l(q){var t,o,n,r,p,u=q.errors,s=d.form.domForm.querySelectorAll(".wwFormFieldError");if(!d.settings.quit){t=d.form.domContainer.querySelector(".wwSuccessText");if(t){t.remove()}}for(p=0;p<s.length;p++){removeClass(s[p],"wwFormFieldError");if(d.settings.errors){o=s[p].querySelector(".wwFormFieldErrorText");if(o){o.remove()}}}for(o in u){if(!u.hasOwnProperty(o)){continue}n=d.form.domForm.querySelector("#"+o+"_container");if(n){r=n.querySelector(".wwFormFieldWrap");if(d.settings.errors){append(r,'<div class="wwFormFieldErrorText">'+u[o]+"</div>")}addClass(n,"wwFormFieldError");addClass(r,"aStep0");for(p=1;p<=3;p++){g(p,3,r)}}}}function g(o,n,p){setTimeout(function(){removeClass(p,"aStep"+(o-1));if(o<n){addClass(p,"aStep"+o)}},o*100)}function e(n){var o=n.getAttribute("src");n.ondblclick=function(){n.setAttribute("src",o+rand(1000,9999))}}function h(p){var o,n=d.form.domContainer.querySelectorAll(".wwFormWarning");for(o=0;o<n.length;o++){n[o].remove()}if(p.data&&p.data!=""){j(p.data,null)}}function j(o,q){var n,p=q?"<div class='wwFormWarning mode"+q+"'>"+o.replace(/<\/?[^>]+>/gi,"")+"</div>":o;if(d.form.domContainer.querySelector(".wwFormWarning")){n=d.form.domContainer.querySelectorAll(".wwFormWarning");after(n[n.length-1],p)}else{prepend(d.form.domContainer,p)}}};this.createLoader=function(g){var h={settings:{inner:g.inner||null,layout:g.layout||"default",color:g.color||"#009FB4"},loader:{domContainer:null,domProgress:null,status:null,show:null,hide:null,setProgress:null}};c();return h.loader;function c(){if(h.settings.inner){var i="<div class='wwLoadWrap wwLoad_"+h.settings.layout+"' onselectstart='return false'><div class='wwLoad' style='color: "+h.settings.color+"'><div class='wwLoadFigure1'></div><div class='wwLoadFigure2'></div><div class='wwLoadProgressWrap'><div class='wwLoadProgress'></div></div></div></div>";append(h.settings.inner,i);h.loader.domContainer=h.settings.inner.querySelector(".wwLoadWrap");h.loader.domProgress=h.loader.domContainer.querySelector(".wwLoadProgress");h.loader.status="hide";h.loader.show=d;h.loader.hide=e;h.loader.setProgress=f}}function d(){if(h.loader.status=="hide"){addClass(h.loader.domContainer,"show");setTimeout(function(){addClass(h.loader.domContainer,"visible")},10);setTimeout(function(){h.loader.status="show"},200)}}function e(){if(h.loader.status=="show"){h.loader.status="hide";removeClass(h.loader.domContainer,"visible");setTimeout(function(){removeClass(h.loader.domContainer,"show");f(0)},200)}else{setTimeout(function(){e()},200)}}function f(i){if(i>=0||i<=100){h.loader.domProgress.style.width=i+"%"}}};this.createIncrease=function(g){var h={settings:{trigger:g.trigger||null,layout:g.layout||"default",color:g.color||"#009FB4"},increase:{domContainer:null,domPrev:null,domNext:null,images:{withoutGroup:[]},loader:new WebWidget()}};c();return h.increase;function c(){if(b&&h.settings.trigger){var j,l,k=document.querySelectorAll(h.settings.trigger);b.onShow=d;b.onHide=f;b.domContent.innerHTML="<div class='wwIncreaseContainer' onselectstart='return false'><a href='#' class='wwIncreasePrev'></a><a href='#' class='wwIncreaseNext'></a></div>";h.increase.domContainer=b.domContent.querySelector(".wwIncreaseContainer");h.increase.domPrev=h.increase.domContainer.querySelector(".wwIncreasePrev");h.increase.domNext=h.increase.domContainer.querySelector(".wwIncreaseNext");h.increase.loader=h.increase.loader.createLoader({inner:h.increase.domContainer,layout:h.settings.layout,color:h.settings.color});for(j=0;j<k.length;j++){if(!k[j].hasAttribute("href")){continue}l=k[j].hasAttribute("data-group")?k[j].getAttribute("data-group"):"withoutGroup";if(!h.increase.images[l]){h.increase.images[l]=[]}l=h.increase.images[l];k[j].setAttribute("data-increase",l.length);l[l.length]={image:k[j].getAttribute("href"),loaded:false}}}}function d(j){if(!j.hasAttribute("data-increase")){return}var k=j.getAttribute("data-increase"),m=j.hasAttribute("data-group")?j.getAttribute("data-group"):"withoutGroup",l=h.increase.images[m];i(l[k]);if(m!="withoutGroup"&&l.length>1){addClass(h.increase.domContainer,"wwIncreaseArrows");h.increase.domPrev.onclick=function(){k<1?k=l.length-1:k--;i(l[k]);return false};h.increase.domNext.onclick=function(){k>=l.length-1?k=0:k++;i(l[k]);return false}}}function f(j){setTimeout(function(){h.increase.domPrev.onclick=h.increase.domNext.onclick=null;removeClass(h.increase.domContainer,"wwIncreaseArrows");e("","auto","auto")},400)}function i(k){var l;if(k.loaded){e("url("+k.image.src+")",k.image.height+"px",k.image.width+"px")}else{l=k.image;h.increase.loader.show();k.image=new Image();try{k.image.src=l;k.image.onload=function(){k.loaded=true;e("url("+k.image.src+")",k.image.height+"px",k.image.width+"px");h.increase.loader.hide()}}catch(j){e("","auto","auto")}}}function e(l,j,k){h.increase.domContainer.style.backgroundImage=l;h.increase.domContainer.style.height=j;h.increase.domContainer.style.width=k}};this.postRequest=function(d){var e={settings:{action:d.action||null,form:d.form||null,data:d.data||null,before:d.before||null,complete:d.complete||null,success:d.success||null,loader:d.loader||null},request:new XMLHttpRequest()};c();return e.request;function c(){if(e.settings.action){var h=null,g=function(){if(f){g=null;if(e.settings.loader){e.settings.loader.show()}if(typeof e.settings.before=="function"){e.settings.before(e.request)}}},f=function(){if(f){f=null;if(e.settings.loader){e.settings.loader.hide()}if(typeof e.settings.complete=="function"){e.settings.complete(e.request)}}};e.request.open("post",e.settings.action);e.request.setRequestHeader("X-Requested-With","XMLHttpRequest");e.request.onloadstart=g;e.request.onloadend=f;if(e.request.upload!==undefined&&e.request.upload.onprogress!==undefined){e.request.upload.onprogress=function(i){if(i.total<500000){return}if(e.settings.loader){e.settings.loader.setProgress(Math.round(event.loaded/event.total*100))}}}e.request.onreadystatechange=function(){if(g){g()}if(this.readyState!=4){return}if(this.status>=200&&this.status<300||this.status===304){if(this.responseText!=""){try{h=JSON.parse(this.responseText)}catch(i){h=h||this.responseText}}if(typeof e.settings.success=="function"){e.settings.success(h)}if(f){f()}}else{debugError("Error: "+(this.status?this.statusText:"request failed!"))}};e.request.send(a(e.request,e.settings.data,e.settings.form))}}};function a(j,h,g){var k,c,l,m=["\r\n"],e=String(Math.random()).slice(2),d="--"+e+"\r\n",f="--"+e+"--\r\n";if(typeof FormData!="undefined"){k=g?new FormData(g):new FormData();if(h){for(l in h){if(!h.hasOwnProperty(l)){continue}k.append(l,h[l])}}return k}else{k={};if(g){c=g.querySelectorAll("input, select, textarea");for(l=0;l<c.length;l++){if(c[l].name!=""&&k[c[l].name]===undefined){switch(c[l].type){case"checkbox":if(c[l].checked){k[c[l].name]="on"}break;case"radio":if(c[l].checked){k[c[l].name]=c[l].value}break;case"select-one":if(c[l].value!=""){k[c[l].name]=c[l].value}break;case"file":k[c[l].name]="Too old browser, the file can not.";break;default:k[c[l].name]=c[l].value}}}}if(h){for(l in h){if(!h.hasOwnProperty(l)){continue}if(!k[l]){k[l]=h[l]}}}for(l in k){if(!k.hasOwnProperty(l)){continue}m.push('Content-Disposition: form-data; name="'+l+"\r\n\r\n"+k[l]+"\r\n")}j.setRequestHeader("Content-Type","multipart/form-data; boundary="+e);return m.join(d)+f}}return this}if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector}if(!Element.prototype.closest){Element.prototype.closest=function(a){var b=this;while(b){if(b.matches(a)){return b}else{b=b.parentElement}}return null}}if(!Element.prototype.remove){Element.prototype.remove=function remove(){if(this.parentNode){this.parentNode.removeChild(this)}}}function debugError(a){if(window.console){console.error(a)}}function prepend(a,b){a=typeof a=="string"?document.querySelector(a):a;if(a.nodeType===1||a.nodeType===11||a.nodeType===9){b.nodeType?a.insertBefore(b,a.firstChild):a.insertAdjacentHTML("afterBegin",b)}}function append(a,b){a=typeof a=="string"?document.querySelector(a):a;if(a.nodeType===1||a.nodeType===11||a.nodeType===9){b.nodeType?a.appendChild(b):a.insertAdjacentHTML("beforeEnd",b)}}function before(a,b){a=typeof a=="string"?document.querySelector(a):a;if(a.nodeType===1||a.nodeType===11||a.nodeType===9){b.nodeType?a.parentNode.insertBefore(b,a):a.insertAdjacentHTML("beforeBegin",b)}}function after(a,b){a=typeof a=="string"?document.querySelector(a):a;if(a.nodeType===1||a.nodeType===11||a.nodeType===9){b.nodeType?a.nextSibling?a.parentNode.insertBefore(b,a.nextSibling):a.parentNode.appendChild(b):a.insertAdjacentHTML("afterEnd",b)}}function trim(a){return null==a?"":(a+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function inArray(b,c){var a;for(a=0;a<c.length;a++){if(c[a]==b){return true}}return false}function addClass(f,e){var d,b=e.match(/\S+/g),g=" "+f.className.replace(/[\t\r\n\f]/g," ")+" ";for(d=0;d<b.length;d++){if(g.indexOf(" "+b[d]+" ")<0){g+=" "+b[d]}}f.className=trim(g);return trim(g)}function removeClass(e,a){var b,d=a.match(/\S+/g),f=" "+e.className.replace(/[\t\r\n\f]/g," ")+" ";for(b=0;b<d.length;b++){while(f.indexOf(" "+d[b]+" ")>=0){f=f.replace(" "+d[b]+" "," ")}}e.className=trim(f)}function rand(b,a){return Math.floor(Math.random()*(a-b+1))+b}function getOffset(f){var c=f.getBoundingClientRect(),a=document.body,g=document.documentElement;return{top:c.top+(window.pageYOffset||g.scrollTop||a.scrollTop)-(g.clientTop||a.clientTop||0),left:c.left+(window.pageXOffset||g.scrollLeft||a.scrollLeft)-(g.clientLeft||a.clientLeft||0)}}function documentOnLoad(j){var d=false,g=false,i=j&&typeof j=="function"?j:null;if(!i){return}if(document.readyState!=="loading"){f()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,false);window.addEventListener("load",b,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",b);window.attachEvent("onload",b);try{d=window.frameElement==null}catch(h){}if(document.documentElement.doScroll&&d){a()}}}function b(){document.addEventListener?document.removeEventListener("DOMContentLoaded",b,false):document.detachEvent("onreadystatechange",b);f()}function f(){if(!g){if(!document.body){setTimeout(f,1);return}g=true;i()}}function a(){if(g){return}try{document.documentElement.doScroll("left")}catch(c){setTimeout(a,1);return}f()}}documentOnLoad(function(){var c,b,a=document.body;addClass(a,"wwSiteScrollTest");c=a.scrollWidth;addClass(a,"wwSiteLock");b=a.scrollWidth;removeClass(a,"wwSiteLock wwSiteScrollTest");append(document.querySelector("head"),"<style type='text/css'>.wwSiteScroll {margin-right:"+(b-c)+"px;}</style>")});